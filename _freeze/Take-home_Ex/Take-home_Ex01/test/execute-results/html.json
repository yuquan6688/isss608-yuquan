{
  "hash": "e568b3fcf73e441ed9ea1102d9f71eda",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Take-home Exercise 1\"\nsubtitle: \"Visual Analytics of Population Structure Across Different Planning Areas in Singapore\"\nauthor: \"Li Yuquan\"\ndescription: \"\"\ndate: \"April 30, 2024\"\ndate-modified: \"last-modified\"\nformat: html\nimage: ../../images/smu.png\neditor: visual\n\n\nexecute: \n  eval: true\n  echo: true\n  warning: false\n  freeze: true\n---\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(ggrepel, patchwork, \n               ggthemes, hrbrthemes,\n               tidyverse, ggdist, ggridges, forcats, viridis, scales,\n               colorspace\n) \n```\n:::\n\n\n\n## 2.3 Importing the data\n\nThe dataset used in this study is in CSV format. The dataset is imported using the  `read_csv()`  function and is named as \"data\".\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata <- read_csv(\"data/respopagesex2024.csv\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndata1 <- data %>%\n  mutate(\n    Age = if_else(Age == \"90_and_Over\", \"90\", as.character(Age)),\n    Age = as.numeric(Age)\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nregion_mapping <- tribble(\n  ~PA,                     ~Region,\n  # Central\n  \"Bishan\",                \"Central\",\n  \"Bukit Merah\",          \"Central\",\n  \"Bukit Timah\",          \"Central\",\n  \"Downtown Core\",        \"Central\",\n  \"Geylang\",              \"Central\",\n  \"Kallang\",              \"Central\",\n  \"Marina East\",          \"Central\",\n  \"Marina South\",         \"Central\",\n  \"Marine Parade\",        \"Central\",\n  \"Museum\",               \"Central\",\n  \"Newton\",               \"Central\",\n  \"Novena\",               \"Central\",\n  \"Orchard\",              \"Central\",\n  \"Outram\",               \"Central\",\n  \"Queenstown\",           \"Central\",\n  \"River Valley\",         \"Central\",\n  \"Rochor\",               \"Central\",\n  \"Singapore River\",      \"Central\",\n  \"Southern Islands\",     \"Central\",\n  \"Straits View\",         \"Central\",\n  \"Tanglin\",              \"Central\",\n  \"Toa Payoh\",            \"Central\",\n\n  # East\n  \"Bedok\",                \"East\",\n  \"Changi\",               \"East\",\n  \"Changi Bay\",           \"East\",\n  \"Pasir Ris\",            \"East\",\n  \"Paya Lebar\",           \"East\",\n  \"Tampines\",             \"East\",\n\n  # North\n  \"Central Water Catchment\", \"North\",\n  \"Lim Chu Kang\",            \"North\",\n  \"Mandai\",                  \"North\",\n  \"Sembawang\",               \"North\",\n  \"Simpang\",                 \"North\",\n  \"Sungei Kadut\",            \"North\",\n  \"Woodlands\",               \"North\",\n  \"Yishun\",                  \"North\",\n\n  # North-East\n  \"Ang Mo Kio\",             \"North-East\",\n  \"Hougang\",                \"North-East\",\n  \"North-Eastern Islands\",  \"North-East\",\n  \"Punggol\",                \"North-East\",\n  \"Seletar\",                \"North-East\",\n  \"Sengkang\",               \"North-East\",\n  \"Serangoon\",              \"North-East\",\n\n  # West\n  \"Boon Lay\",               \"West\",\n  \"Bukit Batok\",            \"West\",\n  \"Bukit Panjang\",          \"West\",\n  \"Choa Chu Kang\",          \"West\",\n  \"Clementi\",               \"West\",\n  \"Jurong East\",            \"West\",\n  \"Jurong West\",            \"West\",\n  \"Pioneer\",                \"West\",\n  \"Tengah\",                 \"West\",\n  \"Tuas\",                   \"West\",\n  \"Western Islands\",        \"West\",\n  \"Western Water Catchment\",\"West\"\n)\n\nv3_region <- data1 %>%\n  left_join(region_mapping, by = \"PA\") %>%\n  filter(!is.na(Region))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nv3_p9 <- v3_region %>%\n  group_by(Region, Sex) %>%\n  summarise(Pop = sum(Pop), .groups = \"drop\") %>%\n  group_by(Region) %>%\n  mutate(\n    Total = sum(Pop),\n    Percent = Pop / Total * 100,\n    Label = paste0(format(Pop, big.mark = \",\"), \n                   \"\\n\", round(Percent, 1), \"%\"),\n    Pop_plot = ifelse(Sex == \"Males\", \n                      Pop, \n                      -Pop)\n  ) %>%\n  mutate(Region = fct_reorder(Region, Total))\n\nv3_p10 <- v3_region %>%\n  uncount(weights = Pop)\n\nv3_p11 <- v3_p10 %>%\n  group_by(Region, Age) %>%\n  sample_frac(0.001)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(v3_p11)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 6\n# Groups:   Region, Age [1]\n  PA            SZ               Age Sex      Time Region \n  <chr>         <chr>          <dbl> <chr>   <dbl> <chr>  \n1 Bukit Timah   Anak Bukit         0 Males    2024 Central\n2 Bukit Merah   Bukit Ho Swee      0 Males    2024 Central\n3 Marine Parade Marine Parade      0 Females  2024 Central\n4 Bishan        Marymount          0 Females  2024 Central\n5 Bishan        Upper Thomson      0 Males    2024 Central\n6 Queenstown    Margaret Drive     0 Females  2024 Central\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(\n       v3_p11, \n             aes(x = Age, \n                 y = Region)) +\n  stat_halfeye(adjust = 0.5,\n               justification = -0.2,\n               .width = 0,\n               scale = 0.3, \n               point_colour = NA) +\n  geom_boxplot(width = .20,\n               scale = 0.2, \n               outlier.shape = NA) +\n  stat_dots(side = \"left\",\n            justification = 1.2,\n            binwidth = .5,\n            scale = 0.2, \n            dotsize = 2) +\n\n  theme_economist()\n```\n\n::: {.cell-output-display}\n![](test_files/figure-html/unnamed-chunk-7-1.png){width=960}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(v3_p11, \n       aes(x = Age, \n           y = Region,\n       color= Region,\n       fill= Region)) +\n  theme_ridges()+\n  geom_density_ridges(jittered_points=TRUE,\n                      aes(point_color=Age),\n                      alpha = 0.7,\n                      scale= 0.7,\n                      point_size = 0.3,\n                      ) +\n  scale_fill_discrete_qualitative('Set 3')+\n  scale_color_discrete_qualitative('Dark 3') +\n  \n   theme(\n    legend.position = \"none\",\n    #panel.grid.major = element_blank(),\n    axis.title.x = element_text(hjust=1, angle=0),\n    plot.background = element_rect(fill=\"#f5f5f5\",colour=\"#f5f5f5\")  \n    )    \n```\n\n::: {.cell-output-display}\n![](test_files/figure-html/unnamed-chunk-8-1.png){width=960}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nv3_ridges <- v3_p10 \n\nv3_points <- v3_p10 %>%\n  group_by(Region, Age) %>%\n  sample_frac(0.0002)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nregion_levels <- levels(fct_rev(factor(v3_ridges$Region)))\n\n# 将 Region 映射为数值以实现散点 y 轴上移\nv3_points <- v3_points %>%\n  mutate(Region_numeric = match(Region, region_levels))\n\n# 绘图\nggplot(v3_ridges, aes(x = Age, y = fct_rev(Region), fill = Region)) +\n  # 密度 ridgeline 图（全量数据）\n  geom_density_ridges(scale = 1, alpha = 0.6, color = \"black\") +\n\n  # 散点 jitter 图（抽样数据，y 整体向上）\n  geom_jitter(data = v3_points,\n              aes(x = Age, y = Region_numeric + 0.31, color = Region),\n              height = 0.3, width = 0,\n              size = 0.4, alpha = 0.6,\n              inherit.aes = FALSE) +\n\n  # 调色板\n  scale_fill_brewer(palette = \"Set3\") +\n  scale_color_brewer(palette = \"Dark2\") +\n\n  # 标签与主题\n  labs(\n    title = \"Age Distribution Across Regions in Singapore\",\n    subtitle = \"Ridgeline shows density; dots show sampled individuals (0.1%)\",\n    x = \"Age\",\n    y = \"Region\"\n  ) +\n  theme_minimal(base_size = 12) +\n  theme(\n    legend.position = \"none\",\n    plot.background = element_rect(fill = \"#f5f5f5\", color = \"#f5f5f5\"),\n    panel.grid.major.y = element_blank(),\n    panel.grid.minor = element_blank(),\n    axis.title.x = element_text(hjust = 1),\n    plot.title = element_text(face = \"bold\", size = 14),\n    plot.subtitle = element_text(size = 10, margin = margin(b = 10))\n  )\n```\n\n::: {.cell-output-display}\n![](test_files/figure-html/unnamed-chunk-10-1.png){width=960}\n:::\n:::",
    "supporting": [
      "test_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}